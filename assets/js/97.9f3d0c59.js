(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{468:function(n,s,a){"use strict";a.r(s);var t=a(16),e=Object(t.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"c-11-condition-variable用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c-11-condition-variable用法"}},[n._v("#")]),n._v(" c++11 condition_variable用法")]),n._v(" "),a("p",[n._v("https://blog.csdn.net/liu3612162/article/details/88343266")]),n._v(" "),a("p",[n._v("condition_variable使用时有以下两种写法")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("//pred是callable，判断条件是否成立\ncv.wait(lck, pred);\n\n//等同于下面的写法\nwhile (!pred()) //如果不满足pred()\n{\n    cv.wait(lck);  //那么继续等待。 \n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("p",[n._v("wait(lck) 展开，等同于执行下面的代码：")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("while (!pred()) //如果不满足pred()\n{\n\t//cv.wait(lck)展开:\n\trelease(lck); //释放锁\n\tblocked_waiting_for_notiry(); //挂起线程，等待其他线程调用cv.notify时才被激活。这里也有可能被虚假唤醒。\n\tlock(lck); //再次尝试加锁，注意此时可能会被再次阻塞。\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br")])]),a("p",[n._v("之所以把wait放在循环中，而不是用下面的if，一是为了防止虚假唤醒，二是防止被唤醒后条件依然不满足\n（可能有其他竞争者，lock时被阻塞；或者notify的线程并没有生产资源使条件满足）。")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("if(!pred()) {\n    cv.wait(lck); \n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br")])]),a("p",[n._v("https://www.jianshu.com/p/c1dfa1d40f53")]),n._v(" "),a("h2",{attrs:{id:"pthread-cond-t用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pthread-cond-t用法"}},[n._v("#")]),n._v(" pthread_cond_t用法")]),n._v(" "),a("p",[n._v("参考: https://blog.csdn.net/chengonghao/article/details/51779279")]),n._v(" "),a("p",[n._v("c++11中的condition_variable是对pthread_cond_t做了一个封装，原理一样的。")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('/***************************************************************\n    *  Copyright (C) 2016 chengonghao\n    *  All rights reserved.\n    *\n    *  chengonghao@yeah.net\n    ***************************************************************/\n#include <unistd.h>\n#include <pthread.h>\n#include <stdio.h>\n\n#define CONSUMERS_COUNT 2\n#define PRODUCERS_COUNT 1\n\npthread_mutex_t g_mutex;\npthread_cond_t g_cond;\n\npthread_t g_thread[CONSUMERS_COUNT + PRODUCERS_COUNT];\nint share_variable = 0; // this is the share variable, shared by consumer and producer\n\nvoid *consumer(void *arg)\n{\n    size_t num = (size_t)arg;\n    while (1)\n    {\n        /******* critical section begin *******/\n        pthread_mutex_lock(&g_mutex);\n\n        // if share_variable == 0, means consumer shell stop here\n        while (share_variable == 0)\n        {\n            printf("consumer %u begin wait a condition...\\n", num);\n            // put a thread blocked ont a condition variable( here is g_cond),\n            // and unlock the mutex( here is g_mutex )\n            pthread_cond_wait(&g_cond, &g_mutex);\n        }\n        // here means n != 0 and consumer can goes on\n        // consumer consumed shared variable, so the number of shared variable shell minus\n        printf("consumer %u end wait a condition...\\n", num);\n        printf("consumer %u begin consume product\\n", num);\n        --share_variable;\n\n        pthread_mutex_unlock(&g_mutex);\n        /******** critial section end *********/\n        sleep(1);\n    }\n\n    return NULL;\n}\n\nvoid *producer(void *arg)\n{\n    size_t num = (size_t)arg;\n    while (1)\n    {\n        /******* critical section begin *******/\n        pthread_mutex_lock(&g_mutex);\n\n        // produce a shared variable\n        printf("producer %u begin produce product...\\n", num);\n        ++share_variable;\n        printf("producer %u end produce product...\\n", num);\n        // unblock threads blocked on a condition variable( here is g_cond )\n        pthread_cond_signal(&g_cond);\n        printf("producer %u notified consumer by condition variable...\\n", num);\n        pthread_mutex_unlock(&g_mutex);\n\n        /******** critial section end *********/\n        sleep(5);\n    }\n\n    return NULL; //1\n}\n\nint test(void)\n{\n    // initiate mutex\n    pthread_mutex_init(&g_mutex, NULL);\n    // initiate condition\n    pthread_cond_init(&g_cond, NULL);\n\n    // initiate consumer threads\n    for (int i = 0; i < CONSUMERS_COUNT; ++i)\n    {\n        pthread_create(&g_thread[i], NULL, consumer, (void *)i);\n    }\n    sleep(1);\n    // initiate producer threads\n    for (int i = 0; i < PRODUCERS_COUNT; ++i)\n    {\n        pthread_create(&g_thread[i], NULL, producer, (void *)i);\n    }\n    for (int i = 0; i < CONSUMERS_COUNT + PRODUCERS_COUNT; ++i)\n    {\n        pthread_join(g_thread[i], NULL);\n    }\n\n    pthread_mutex_destroy(&g_mutex);\n    pthread_cond_destroy(&g_cond);\n}\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br")])]),a("h2",{attrs:{id:"leetcode题目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leetcode题目"}},[n._v("#")]),n._v(" LeetCode题目")]),n._v(" "),a("p",[n._v("https://leetcode-cn.com/problems/print-in-order/solution/cpp-beats-100-shi-yong-tiao-jian-bian-liang-by-geo/")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('#include <iostream>\n#include <string>\n#include <functional>\n#include <mutex>\n#include <condition_variable>\n#include <thread>\n\nusing namespace std;\n\n\nclass Foo {\nprivate:\n\tint counter = 1;\n\tstd::condition_variable cv1, cv2;\n\t// 使用lock和unlock手动加锁\n\tstd::mutex g_mutex;\n\npublic:\n\tFoo() {}\n\npublic:\n\tvoid first() {\n\t\t// 等待直至 main() 发送数据\n\t\tstd::unique_lock<std::mutex> lk(g_mutex);  \n\t\tprintf("print first.\\n");\n\t\t// 通知前完成手动解锁，以避免等待线程才被唤醒就阻塞（细节见 notify_one ）\n\t\tcounter++;\n\t\tcv1.notify_one();\n\t}\n\n\tvoid second() {\n\t\tstd::unique_lock<std::mutex> lk(g_mutex);\n\t\tcv1.wait(lk, [this]() {return counter == 2; }); // 阻塞当前线程，直到条件变量被唤醒 \n\t\tprintf("print second.\\n");\n\t\tcounter++;\n\t\tcv2.notify_one();\n\t}\n\n\tvoid third() {\n\t\tstd::unique_lock<std::mutex> lk(g_mutex);\n\t\tcv2.wait(lk, [this]() {return counter == 3; });\n\t\tprintf("print thrid.\\n");\n\t}\n\n};\n\n\nint main()\n{\n\tFoo f;\n\tthread t2(&Foo::second, &f);\n\tthread t3(&Foo::third, &f);\n\tthread t1(&Foo::first, &f);\n\tt1.join();\n\tt2.join();\n\tt3.join();\n\treturn 0;\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br")])]),a("h2",{attrs:{id:"unique-lock和lock-guard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unique-lock和lock-guard"}},[n._v("#")]),n._v(" unique_lock和lock_guard")]),n._v(" "),a("p",[n._v("https://www.cnblogs.com/xudong-bupt/p/9194394.html")]),n._v(" "),a("h2",{attrs:{id:"生产者和消费者例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产者和消费者例子"}},[n._v("#")]),n._v(" 生产者和消费者例子")]),n._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<iostream>\n#include<vector>\nusing namespace std;\n\n\nint cargo = 0;\nmutex g_mutex;\ncondition_variable cv_consumer, cv_producer;\nbool consumer_exit = false;\n\nvoid consumer(int thread_index) {\n\tthis_thread::sleep_for(chrono::milliseconds(1000));\n\twhile (true) {\n\t\tthis_thread::sleep_for(chrono::milliseconds(rand() % 300)); // simulate porcessing goods.\n\t\tunique_lock<mutex> lck(g_mutex); //acquire lock befor modify cargo.\n\t\tcv_consumer.wait(lck, []() {return (cargo > 0 || consumer_exit); });\n\t\tcout << thread_index <<" get lock" << endl;\n\t\tif (consumer_exit) {\n\t\t\tcout <<"thread "<<thread_index <<" exit" << endl;\n\t\t\tlck.unlock();\n\t\t\tcv_consumer.notify_one();\n\t\t\tbreak;\n\t\t}\n\t\tcargo--;\n\t\tcout <<"thread " << thread_index << " consume 1 goods, current goods: " << cargo << endl;\n\t\tlck.unlock(); //release lock to let other thread run.\n\t\tcout << thread_index << " release lock" <<endl;\n\t\tif (!cargo)\n\t\t\tcv_producer.notify_one();\n\t\telse\n\t\t\tcv_consumer.notify_one();\n\t\tthis_thread::sleep_for(chrono::milliseconds(200)); // simulate porcessing goods.\n\t}\n\t//cout << "thread " << thread_index << " end" << endl;\n}\n\nvoid deamon() {\n\t// in case all threads are sleep and notify is ignored, periodly notify to wake up.\n\twhile (!consumer_exit) {\n\t\tthis_thread::sleep_for(chrono::seconds(3));\n\t\tcv_consumer.notify_one();\n\t\tcv_producer.notify_one();\n\t\tcout << "current goods : " << cargo << endl;\n\t\tif (g_mutex.try_lock()) {\n\t\t\tcout << "mutex is avaliable" << endl;\n\t\t\tg_mutex.unlock();\n\t\t}\n\t\telse {\n\t\t\tcout << "mutex is unavaliable" << endl;\n\t\t}\n\t}\n\tthis_thread::sleep_for(chrono::seconds(3));\n\tcv_consumer.notify_one();\n\tcv_producer.notify_one();\n}\n\nint main() {\n\tvector<thread> vec;\n\n\tthread t_deamon = thread(deamon);\n\n\tfor (int i = 0; i < 3; ++i) {\n\t\tthread t = thread(consumer, i);\n\t\tvec.emplace_back(move(t));\n\t}\n\n\tfor (int i = 0; i < 2; ++i) {\n\t\tunique_lock<mutex> lck(g_mutex);\n\t\tcv_producer.wait(lck, []() {return (cargo == 0); });\n\t\tcout << "main get lock" << endl;\n\t\tcargo += 5;\n\t\tcout << "produce goods " << (i+1)*5 <<"  current goods: "<< cargo << endl;\n\t\tlck.unlock();\n\t\tcout << "main release lock" << endl;\n\t\tcv_consumer.notify_one();\n\t\tthis_thread::sleep_for(chrono::milliseconds(rand() % 2000)); //simulate producing.\n\t}\n\n\twhile (cargo > 0) {\n\t\tthis_thread::sleep_for(chrono::seconds(1));\n\t}\n\tconsumer_exit = true;\n\tcout << "produce end" << endl;\n\tcv_consumer.notify_one();\n\n\tfor (auto &t : vec) {\n\t\tt.join();\n\t}\n\tt_deamon.join();\n\tcout << "main end" << endl;\n}\n\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);