(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{484:function(s,a,e){"use strict";e.r(a);var n=e(16),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("参考："),e("a",{attrs:{href:"https://blog.csdn.net/Virgil_K2017/article/details/90382201",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/Virgil_K2017/article/details/90382201"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("次参考："),e("a",{attrs:{href:"https://blog.csdn.net/demonson/article/details/80526533",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/demonson/article/details/80526533"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"一、准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、准备工作"}},[s._v("#")]),s._v(" 一、准备工作：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1.主从数据库版本最好一致\n2.主从数据库内数据保持一致\n主数据库：182.92.172.80 /linux\n从数据库：123.57.44.85 /linux\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"二、主数据库master修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、主数据库master修改"}},[s._v("#")]),s._v(" 二、主数据库master修改：")]),s._v(" "),e("p",[e("strong",[s._v("1.修改mysql配置")]),s._v("\n找到主数据库的配置文件my.cnf(或者my.ini)，我的在/etc/mysql/my.cnf,在[mysqld]部分插入如下两行：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("log-bin=mysql-bin #开启二进制日志\nserver-id=1 #设置server-id\n\n# 其他设置\nbinlog_format = mixed\nexpire_logs_days = 8\n; log_bin_trust_function_creators = 1\nsync_binlog=0\nmax_binlog_size=512M\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[e("strong",[s._v("2.重启mysql，创建用于同步的用户账号")]),s._v("\n打开mysql会话shell>mysql -hlocalhost -uname -ppassword\n创建用户并授权：用户：rel1密码：slavepass")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> CREATE USER 'repl'@'123.57.44.85' IDENTIFIED BY 'slavepass';#创建用户\nmysql> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'123.57.44.85';#分配权限\nmysql>flush privileges;   #刷新权限\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("3.查看master状态，记录二进制文件名(mysql-bin.000003)和位置(73)：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql > SHOW MASTER STATUS;\n+------------------+----------+--------------+------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000003 | 73       | test         | manual,mysql     |\n+------------------+----------+--------------+------------------+\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"三、从服务器slave修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、从服务器slave修改"}},[s._v("#")]),s._v(" 三、从服务器slave修改：")]),s._v(" "),e("h4",{attrs:{id:"_1-修改mysql配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改mysql配置"}},[s._v("#")]),s._v(" 1.修改mysql配置")]),s._v(" "),e("p",[s._v("同样找到my.cnf配置文件，添加server-id")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=2 #设置server-id，必须唯一\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"_2-重启mysql-打开mysql会话-执行同步sql语句-需要主服务器主机名-登陆凭据-二进制文件的名称和位置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-重启mysql-打开mysql会话-执行同步sql语句-需要主服务器主机名-登陆凭据-二进制文件的名称和位置"}},[s._v("#")]),s._v(" 2.重启mysql，打开mysql会话，执行同步SQL语句(需要主服务器主机名，登陆凭据，二进制文件的名称和位置)：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CHANGE MASTER TO\nMASTER_HOST='182.92.172.80',\nMASTER_USER='rep1',\nMASTER_PASSWORD='slavepass',\nMASTER_LOG_FILE='mysql-bin.000003',\nMASTER_LOG_POS=73;\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h4",{attrs:{id:"_3-启动slave同步进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动slave同步进程"}},[s._v("#")]),s._v(" 3.启动slave同步进程：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql>start slave;\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"_4-查看slave状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看slave状态"}},[s._v("#")]),s._v(" 4.查看slave状态：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 182.92.172.80\n                  Master_User: rep1\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000013\n          Read_Master_Log_Pos: 11662\n               Relay_Log_File: mysqld-relay-bin.000022\n                Relay_Log_Pos: 11765\n        Relay_Master_Log_File: mysql-bin.000013\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: \n          Replicate_Ignore_DB: \n        ...\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("当Slave_IO_Running和Slave_SQL_Running都为YES的时候就表示主从同步设置成功了。接下来就可以进行一些验证了，比如在主master数据库的test数据库的一张表中插入一条数据，在slave的test库的相同数据表中查看是否有新增的数据即可验证主从复制功能是否有效，还可以关闭slave（mysql>stop slave;）,然后再修改master，看slave是否也相应修改（停止slave后，master的修改不会同步到slave），就可以完成主从复制功能的验证了。")]),s._v(" "),e("p",[s._v("还可以用到的其他相关参数：")]),s._v(" "),e("p",[s._v("master开启二进制日志后默认记录所有库所有表的操作，可以通过配置来指定只记录指定的数据库甚至指定的表的操作，具体在mysql配置文件的[mysqld]可添加修改如下选项：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 不同步哪些数据库  \nbinlog-ignore-db = mysql  \nbinlog-ignore-db = test  \nbinlog-ignore-db = information_schema  \n  \n# 只同步哪些数据库，除此之外，其他不同步  \nbinlog-do-db = game\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("如之前查看master状态时就可以看到只记录了test库，忽略了manual和mysql库。")]),s._v(" "),e("h2",{attrs:{id:"取消主从复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#取消主从复制"}},[s._v("#")]),s._v(" 取消主从复制")]),s._v(" "),e("p",[s._v("Mysql取消主从复制很简单。只需在其要终止同步的Server上【一般是Slave】执行下面语句即可：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("stop slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nreset slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);