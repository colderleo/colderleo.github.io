(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{578:function(a,s,e){"use strict";e.r(s);var n=e(21),t=Object(n.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h3",{attrs:{id:"功夫官方github上readme-md中的编译指导"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#功夫官方github上readme-md中的编译指导"}},[a._v("#")]),a._v(" 功夫官方GitHub上README.md中的编译指导")]),a._v(" "),e("h5",{attrs:{id:"windows上开发工具的安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windows上开发工具的安装"}},[a._v("#")]),a._v(" windows上开发工具的安装")]),a._v(" "),e("p",[a._v("开发组在 Visual Studio 2017 15.9.14 环境下进行工作，安装时需要勾选 VC140（Visual Studio 2015) toolset。")]),a._v(" "),e("p",[a._v("下载并安装 "),e("a",{attrs:{href:"https://git-scm.com/download/win",target:"_blank",rel:"noopener noreferrer"}},[a._v("git"),e("OutboundLink")],1),a._v("，"),e("a",{attrs:{href:"https://www.python.org/downloads/windows/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Python 3"),e("OutboundLink")],1),a._v("，"),e("a",{attrs:{href:"https://cmake.org/install/",target:"_blank",rel:"noopener noreferrer"}},[a._v("CMake"),e("OutboundLink")],1),a._v("，"),e("a",{attrs:{href:"https://nodejs.org/en/download/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Node.js LTS 10.15.3"),e("OutboundLink")],1),a._v(" 并添加相应路径至 %PATH% 环境变量。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("C:\\> npm install -g yarn electron-builder\nC:\\> pip install pipenv\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("注意不要使用 Win64 后缀的 generator，如果遇到如下报错：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("CMake Error:\n  Generator\n\n    Visual Studio 15 2017 Win64\n\n  does not support platform specification, but platform\n\n    x64\n\n  was specified.\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("p",[a._v("需要手动指定 cmake generator 之后重新编译：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('npm config set cmake_js_G "Visual Studio 15 2017"\nyarn clean\nyarn build\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h5",{attrs:{id:"常规编译操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常规编译操作"}},[a._v("#")]),a._v(" 常规编译操作")]),a._v(" "),e("p",[a._v("获取代码并编译：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ git clone https://github.com/taurusai/kungfu\n$ cd kungfu\n$ yarn\n$ yarn build\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("编译结果输出在 app/build 目录下，例如在 MacOSX 系统上，最终的可执行文件输出在 app/build/mac/Kungfu.Trader.app。")]),a._v(" "),e("p",[a._v("遇到编译问题需要完整的重新编译时，执行以下命令清理临时文件：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ yarn clean\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h5",{attrs:{id:"选择编译模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择编译模式"}},[a._v("#")]),a._v(" 选择编译模式")]),a._v(" "),e("p",[a._v("功夫默认编译为 Release 模式（-D"),e("a",{attrs:{href:"https://cmake.org/cmake/help/v3.12/variable/CMAKE_BUILD_TYPE.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("CMAKE_BUILD_TYPE"),e("OutboundLink")],1),a._v('="Release")，如果希望以 Debug 模式编译，需要执行以下命令：')]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('$ npm config set kungfu-core:buildtype "Debug"\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("执行以下命令恢复 Release 模式：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('$ npm config set kungfu-core:buildtype "Release"\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("切换编译模式后，需要执行以下命令重新生成配置文件：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ yarn workspace kungfu-core run configure\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h5",{attrs:{id:"编译过程产生的临时文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译过程产生的临时文件"}},[a._v("#")]),a._v(" 编译过程产生的临时文件")]),a._v(" "),e("p",[a._v("编译过程会在代码所在目录下生成如下临时文件：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("node_modules\nbuild\ndist\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("通常情况下可通过执行如下命令对 build 和 dist 进行清理：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ yarn clean\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("需要注意 node_modules 目录为 npm 产生的包目录，一般情况下无需清除，如有特殊需要可手动删除。")]),a._v(" "),e("p",[a._v("另外，编译过程中会在系统的以下路径产生输出：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$HOME/.cmake-js                     # cmake.js 存储的 C++ 依赖包\n$HOME/.virtualenvs                  # pipenv(windows) 存储的 Python 依赖\n$HOME/.local/share/virtualenvs      # pipenv(unix) 存储的 Python 依赖\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("如果需要清理这些文件，都需要手动删除。")]),a._v(" "),e("h3",{attrs:{id:"官方指导安装中可能遇到的错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#官方指导安装中可能遇到的错误"}},[a._v("#")]),a._v(" 官方指导安装中可能遇到的错误：")]),a._v(" "),e("h5",{attrs:{id:"下载失败"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载失败"}},[a._v("#")]),a._v(" 下载失败")]),a._v(" "),e("p",[a._v("设置nmp的淘宝源，或者网上搜解决方案。也可能需要设置成国外的源地址")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("国外的源地址：npm config set registry http://registry.npmjs.org")])]),a._v(" "),e("li",[e("p",[a._v("淘宝源：npm config set registry https://registry.npm.taobao.org")])])]),a._v(" "),e("h5",{attrs:{id:"提示-python-executable-python2-in-the-path-gyp-verb-which-failed-error-not-found-。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#提示-python-executable-python2-in-the-path-gyp-verb-which-failed-error-not-found-。"}},[a._v("#")]),a._v(' 提示“Python executable "python2" in the PATH gyp verb '),e("code",[a._v("which")]),a._v(" failed Error: not found”。")]),a._v(" "),e("p",[a._v("解决方法：安装python2，将python.exe改名为python2.exe，并将其所在的路径加入环境变量")]),a._v(" "),e("p",[a._v("后面可能会再出现一次类似的错误，找不到python.exe，那么再将python2.exe改回来")]),a._v(" "),e("h5",{attrs:{id:"resolutionfailure-numpy-1-16-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resolutionfailure-numpy-1-16-4"}},[a._v("#")]),a._v(' ResolutionFailure：numpy = "==1.16.4"')]),a._v(" "),e("p",[a._v('在项目文件夹内搜索1.16.4，可发现“core\\Pipfile”中有numpy = "==1.16.4"，将其改成1.16.5或其他满足Resolution的版本。')]),a._v(" "),e("h3",{attrs:{id:"上期ctp模拟账号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上期ctp模拟账号"}},[a._v("#")]),a._v(" 上期CTP模拟账号")]),a._v(" "),e("p",[a._v("account_config")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('\'{"account_id": "161772", "password": "gaoliu725224", "broker_id": "9999", "auth_code": "0000000000000000", "product_info": "KUNGFU", "app_id": "simnow_client_test", "md_uri": "tcp://180.168.146.187:10131", "td_uri": "tcp://180.168.146.187:10130"}\'\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"build相关的文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build相关的文件"}},[a._v("#")]),a._v(" build相关的文件")]),a._v(" "),e("p",[a._v("core yarn build:cpp")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"build:cpp"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cross-var pipenv run python python/build.py --build_type '),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_buildtype")]),a._v(" -l "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_loglevel")]),a._v(" --arch "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_arch")]),a._v(" --runtime "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_runtime")]),a._v(" --node_version "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_node")]),a._v(" --electron_version "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_electron")]),a._v(' make"')]),a._v(",\n\nonfig_node --electron_version "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$npm_package_config_electron")]),a._v(' make",\n\npipenv run python python/build.py --build_type Release -l trace --arch x64 --runtime electron --node_version '),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.16")]),a._v(".0 --electron_version "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.2")]),a._v(".11 "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_buildtype")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Release\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_loglevel")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("trace\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_arch")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("x64\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_runtime")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("electron\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_node")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.16")]),a._v(".0\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("npm_package_config_electron")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.2")]),a._v(".11\n\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br")])]),e("h4",{attrs:{id:"项目架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目架构"}},[a._v("#")]),a._v(" 项目架构")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("功夫前端是vue + electron， 前端electron运行与node.js上，node.js中通过pm2调用kfc.exe创建进程")])]),a._v(" "),e("li",[e("p",[a._v("kfc.exe是通过pyinstaller将python打包得到的，不运行kfc.exe，直接运行core/python dev_run.py也是一样效果。")])]),a._v(" "),e("li",[e("p",[a._v("后台核心是c++编写的，通过pybind11编译成pyd文件(python模块)，供python调用。")])])]),a._v(" "),e("h4",{attrs:{id:"通过python-dev调用kfc-kungfu-core"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过python-dev调用kfc-kungfu-core"}},[a._v("#")]),a._v(" 通过python_dev调用kfc(kungfu-core)")]),a._v(" "),e("p",[a._v("用非打包的python脚本运行功夫中台")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cd kungfu\ncd core/python\n\n# 激活pipenv的python虚拟环境\npipenv shell\n\n# 创建master主进程 -l trace是log等级\npython dev_run.py -l trace master\n\n# 创建TradeData交易进程 161772是账户名\npython dev_run.py -l trace td -s ctp -a 161772\n\n# 完整路径调用\nC:\\Users\\gaoliu\\.virtualenvs\\core-4QtN55Bn\\Scripts\\python.exe E:\\gaoliu\\mycode\\kungfu\\core\\python\\dev_run.py -l trace td -s ctp -a 161772\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br")])]),e("p",[a._v("extensions.ctp.kfext_ctp.TD")]),a._v(" "),e("p",[a._v("通过python dev_run调用策略：")]),a._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[a._v("python dev_run"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("py strategy "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("path "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"E:\\gaoliu\\mycode\\kungfu\\examples\\strategy\\py\\strategy_demo.py"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("name "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"strategy_demo"')]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("js创建进程的代码")]),a._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[a._v("app\\shared\\utils\\processUtils"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("ts\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" startProcess "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("async")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("options"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" no_ext "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);