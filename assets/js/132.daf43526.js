(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{615:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),a("ul",[a("li",[s._v("官方文档："),a("a",{attrs:{href:"https://cmake.org/cmake/help/v3.14/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://cmake.org/cmake/help/v3.14/"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("设置和使用变量\nhttps://cloud.tencent.com/developer/ask/121477")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MyString "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Some Text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MyStringWithVar "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Some other Text: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MyString}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("从cmake命令行传入变量 -D")]),s._v(" "),a("p",[s._v("CMakeLists.txt:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("aa "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMESSAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("aa"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aa}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMESSAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${bb}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("执行cmake")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p build\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" build\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" -Dbb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("aa=123\nbb=456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"非常好用的cmakelists-txt模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非常好用的cmakelists-txt模板"}},[s._v("#")]),s._v(" 非常好用的CMakeLists.txt模板")]),s._v(" "),a("p",[s._v("假设项目文件夹名为cmake_demo，其包含了test1、test2两个（即两个子文件夹）。")]),s._v(" "),a("p",[s._v("首先在根目录下创建CMakeLists.txt:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CMAKE_MINIMUM_REQUIRED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VERSION "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncmake_policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VERSION "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建项目，相当于vs中创建了cmake_demo.sln")]),s._v("\nPROJECT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmake_demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加C++版本支持")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_CXX_STANDARD "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_CXX_STANDARD_REQUIRED True"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# * CMAKE_SOURCE_DIR 是最上层CMakeLists.txt所在的文件夹 (注意：子目录中用了project()后，该变量就是porject所在的文件夹了!!!)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# * CMAKE_CURRENT_SOURCE_DIR 当前CMakeLists.txt所在的文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# * CMAKE_CURRENT_BINARY_DIR 是执行cmake时会拷贝当前CMakeLists.txt到build里对应的文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# * CMAKE_BINARY_DIR 就是执行cmake的文件夹，一般是build文件夹")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 假设CMakeLists.txt位于项目根目录`rootdir`，设置lib的生成目录为`rootdir/lib`, ")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_ARCHIVE_OUTPUT_DIRECTORY "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_SOURCE_DIR}")]),s._v("/lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_LIBRARY_OUTPUT_DIRECTORY "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_SOURCE_DIR}")]),s._v("/lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置可执行文件的生成目录为build/../bin")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_RUNTIME_OUTPUT_DIRECTORY "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_SOURCE_DIR}")]),s._v("/bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置编译flag，debug和release, 不指定CMAKE_BUILD_TYPE时，默认release版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 编译debug版本: cmake -D CMAKE_BUILD_TYPE=debug ..   或者在CMakeLists设置set(CMAKE_BUILD_TYPE "debug")')]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" CMAKE_CXX_FLAGS "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_CXX_FLAGS}")]),s._v(' -pthread"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" CMAKE_CXX_FLAGS "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_CXX_FLAGS}")]),s._v(' -Wall -Wformat=0 -Wno-sign-compare -Wno-unused-variable"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" CMAKE_CXX_FLAGS_DEBUG "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_CXX_FLAGS}")]),s._v(' -g -O0 -DDEBUG"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" CMAKE_CXX_FLAGS_RELEASE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CMAKE_CXX_FLAGS}")]),s._v(' -O2 -DNDEBUG"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# (根据需要)添加宏定义 "_GNU_SOURCE" 和 "_DEFAULT_SOURCE"')]),s._v("\nadd_definitions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-D_GNU_SOURCE -D_DEFAULT_SOURCE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加git版本相关的宏定义")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 程序中打印: printf("%s\\n", "version: git_tag=" GIT_TAG ", commit_it=" COMMIT_ID);')]),s._v("\nexecute_process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("COMMAND "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" describe --tag --always --dirty\n    OUTPUT_VARIABLE  GIT_TAG\n    OUTPUT_STRIP_TRAILING_WHITESPACE\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("git_tag "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GIT_TAG}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexecute_process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("COMMAND "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" rev-parse HEAD\n    OUTPUT_VARIABLE  COMMIT_ID\n    OUTPUT_STRIP_TRAILING_WHITESPACE\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("commit_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${COMMIT_ID}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nadd_definitions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-DGIT_TAG"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GIT_TAG}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadd_definitions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-DCOMMIT_ID"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${COMMIT_ID}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加头文件搜索路径(.h) 当前文件夹和include")]),s._v("\ninclude_directories"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(". include"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加库文件搜索路径(.lib, .a, .so)")]),s._v("\nlink_directories"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建可执行文件some_test")]),s._v("\nadd_executable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("some_test some_test.cpp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 链接libdl.so 和 libm.so")]),s._v("\ntarget_link_libraries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("some_test dl m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加test1和test2两个子文件夹，windows下相当于vs中的sln添加了两个project。")]),s._v("\nadd_subdirectory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadd_subdirectory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("p",[s._v("test1文件夹下的CMakeLists.txt, 添加一个可执行文件test")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将该目录下的所有源文件名加入到变量DIR_SRCS中。这是偷懒的做法，最好把具体文件列出来")]),s._v("\naux_source_directory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(". DIR_SRCS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将上面得到的${DIR_SRCS}这些源文件作为source，编译出可执行文件test或者test.exe")]),s._v("\nadd_executable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test1 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DIR_SRCS}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果需要链接外部的动态库文件，则在 add_executable 后面加，比如test1要链接到libtrace.so：")]),s._v("\ntarget_link_libraries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test1 trace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("test2文件夹下的CMakeLists.txt, 添加一个lib")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 子项目test2也可以用cmake中的project(test2) 最好不要用。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建LIB_SOURCE_FILES变量，存储一些文件名")]),s._v("\nSET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LIB_SOURCE_FILES aaa.cpp bbb.cpp ccc.cpp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成库，地位等同于 add_executable().  SHARED表示生成动态库，linux下会生成libtest2.so, windows应该会生成test2.dll")]),s._v("\nadd_library"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test2 SHARED "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LIB_SOURCE_FILES}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制生成的so文件到lib文件夹，路径可能有问题需要调整")]),s._v("\nIF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("WIN32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    MESSAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("STATUS "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"###########################OS is windows###########################"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nELSEIF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UNIX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    MESSAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("STATUS "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"###########################OS is UNIX-like OS\'s.###########################"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    FILE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("COPY libtest2.so DESTINATION lib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nENDIF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("这样在windows下编译出的vs2017工程为cmake_demo.sln，它包含了test1.vcxproj、test2.vcxproj两个project。")]),s._v(" "),a("p",[s._v("在linux下会生成Makefile， 可以用make编译。")]),s._v(" "),a("h2",{attrs:{id:"先在build文件夹中生成项目文件-然后执行编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#先在build文件夹中生成项目文件-然后执行编译"}},[s._v("#")]),s._v(" 先在build文件夹中生成项目文件, 然后执行编译")]),s._v(" "),a("p",[s._v("先创建build文件夹，用cmake在build文件夹下生成项目文件，再编译")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" cmake_demo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" build\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" build\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\ncmake --build "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("对于linux，最后一句 "),a("code",[s._v("cmake --build .")]),s._v("等同于 "),a("code",[s._v("make")])]),s._v(" "),a("p",[s._v("对于windows，最后一句相当于是调用visual studio编译。")]),s._v(" "),a("p",[s._v("windows下生成工程时指定vs版本：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("cmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" -G "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Visual Studio 15 2017 Win64"')]),s._v("\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" -G "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Visual Studio 15 2017"')]),s._v(" -A x64\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" -G "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Visual Studio 16 2019 Win32"')]),s._v("\n\ncmake --build "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --config Debug\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("-G是generator， -A是generator支持的platform")]),s._v(" "),a("li",[s._v("参考cmake官方文档 https://cmake.org/cmake/help/v3.18/generator/Visual%20Studio%2015%202017.html")]),s._v(" "),a("li",[s._v("vs2017对应的-A可以加 Win32 x64 ARM ARM64")])]),s._v(" "),a("h2",{attrs:{id:"cmake中常用的变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmake中常用的变量"}},[s._v("#")]),s._v(" cmake中常用的变量")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/Useful-Variables",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/Useful-Variables"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("CMAKE_SOURCE_DIR 是最上层CMakeLists.txt所在的文件夹 (用了project()可能是porject所在的文件夹了)")]),s._v(" "),a("li",[s._v("CMAKE_CURRENT_SOURCE_DIR 当前CMakeLists.txt所在的文件夹")]),s._v(" "),a("li",[s._v("CMAKE_BINARY_DIR 就是执行cmake的文件夹，一般是build文件夹")]),s._v(" "),a("li",[s._v("CMAKE_CURRENT_BINARY_DIR 是执行cmake时会拷贝当前CMakeLists.txt到build里对应的文件夹")])]),s._v(" "),a("h3",{attrs:{id:"上面添加了git版本相关的宏定义-程序中用法如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上面添加了git版本相关的宏定义-程序中用法如下"}},[s._v("#")]),s._v(" 上面添加了git版本相关的宏定义，程序中用法如下：")]),s._v(" "),a("p",[s._v("main.cpp:")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("ifndef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("GIT_TAG")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("GIT_TAG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no_git_tag"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("ifndef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("COMMIT_ID")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("COMMIT_ID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no_commit_id"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("endif")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下面写法的好处是 strings a.out | grep version 即可得到commit_id")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version: git_tag="')]),s._v(" GIT_TAG "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('", commit_it="')]),s._v(" COMMIT_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"指定编译器路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定编译器路径"}},[s._v("#")]),s._v(" 指定编译器路径")]),s._v(" "),a("p",[s._v("cmake -DCMAKE_CXX_COMPILER=/path/to/your/g++")]),s._v(" "),a("h2",{attrs:{id:"设置build-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置build-type"}},[s._v("#")]),s._v(" 设置build type")]),s._v(" "),a("p",[s._v("命令行中指定build type:  "),a("code",[s._v("cmake -DCMAKE_BUILD_TYPE=Debug ..")])]),s._v(" "),a("p",[s._v("CMakeLists.txt中指定build type")]),s._v(" "),a("div",{staticClass:"language-py line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_BUILD_TYPE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Debug"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("CMakeLists.txt中配置不同的编译选项")]),s._v(" "),a("div",{staticClass:"language-py line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置不同build type对应的编译选项")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_CXX_FLAGS_DEBUG   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O0  -pthread -g "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_CXX_FLAGS_RELEASE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O2  -pthread -DNDEBUG "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_C_FLAGS_DEBUG   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O0 -pthread "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_C_FLAGS_RELEASE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O2 -pthread -DNDEBUG "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不用build type, 则不要对应的type")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_CXX_FLAGS   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O2 -pthread"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CMAKE_C_FLAGS_DEBUG   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-O2 -pthread"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"find-package用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#find-package用法"}},[s._v("#")]),s._v(" find_package用法")]),s._v(" "),a("p",[s._v("https://github.com/BrightXiaoHan/CMakeTutorial/tree/master/FindPackage")]),s._v(" "),a("p",[s._v("通过Find"),a("code",[s._v("<LibaryName>")]),s._v(".cmake 模块，找到相关的路径。")]),s._v(" "),a("p",[s._v("每一个模块都会定义以下几个变量：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("<LibaryName>")]),s._v("_FOUND")]),s._v(" "),a("li",[a("code",[s._v("<LibaryName>")]),s._v("_INCLUDE_DIRS or"),a("code",[s._v("<LibaryName>")]),s._v("_INCLUDES")]),s._v(" "),a("li",[a("code",[s._v("<LibaryName>")]),s._v("_LIBRARYS or"),a("code",[s._v("<LibaryName>")]),s._v("_LIBRARIES")])]),s._v(" "),a("p",[s._v("你可以通过"),a("code",[s._v("<LibaryName>")]),s._v("_FOUND 来判断模块是否被找到，如果没有找到，可给出提醒或者中止编译。")]),s._v(" "),a("p",[s._v("如果"),a("code",[s._v("<LibaryName>")]),s._v("_FOUND 为真，则加入头文件目录，链接库文件。")]),s._v(" "),a("div",{staticClass:"language-cmake line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cmake"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("find_package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curltest curltest.cc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CURL_FOUND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include_directories")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clib "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("PRIVATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("${")]),s._v("CURL_INCLUDE_DIRS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("target_link_libraries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curltest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("${")]),s._v("CURL_LIBRARYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CURL_FOUND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("FATAL_ERROR ”CURL library not found”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("endif")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CURL_FOUND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"windows生成动态链接库时导出接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows生成动态链接库时导出接口"}},[s._v("#")]),s._v(" windows生成动态链接库时导出接口")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("一种方法是自动导出所有的函数")]),s._v(" "),a("div",{staticClass:"language-cmake line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cmake"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选在windows上生成dll时导出所有的函数，这样不用写def之类的了。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("ON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加动态链接库文件 nanomsg.dll, nanomsg.so")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("target_link_libraries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test nanomsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("另一种是利用cmake的函数GENERATE_EXPORT_HEADER自动生成辅助头文件")]),s._v(" "),a("ul",[a("li",[s._v("github上的一个例子："),a("a",{attrs:{href:"https://github.com/gklingler/sharedLibsDemo",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/gklingler/sharedLibsDemo"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("另一个例子："),a("a",{attrs:{href:"https://blog.csdn.net/LaineGates/article/details/83899961",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/LaineGates/article/details/83899961"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[a("p",[s._v("其他就是不用cmake，直接手写__declspec(dllexport)")])])]),s._v(" "),a("h2",{attrs:{id:"添加boost库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加boost库"}},[s._v("#")]),s._v(" 添加boost库")]),s._v(" "),a("div",{staticClass:"language-cmake line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cmake"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("BOOST_ROOT")]),s._v(" /usr/local/src/boost_1_76_0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("find_package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Boost REQUIRED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include_directories")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("${")]),s._v("Boost_INCLUDE_DIRS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("MESSAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" STATUS "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Boost_INCLUDE_DIRS = '),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("Boost_INCLUDE_DIRS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);