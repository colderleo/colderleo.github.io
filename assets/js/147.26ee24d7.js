(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{629:function(s,a,t){"use strict";t.r(a);var n=t(21),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("a",{attrs:{href:"https://www.freesion.com/article/71371199944/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.freesion.com/article/71371199944/"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"x86寄存器命名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#x86寄存器命名"}},[s._v("#")]),s._v(" x86寄存器命名")]),s._v(" "),t("p",[s._v("64位有16个寄存器，r开头\n32位只有8个，e开头")]),s._v(" "),t("p",[s._v("AX、BX、CX、DX、SI、DI、SP、BP 等是16位寄存器\n有时候也用SP表示SP、ESP、RSP的统称。")]),s._v(" "),t("p",[s._v("sp 栈指针寄存器\nesp和ebp是32位 （extend）\nrsp和rbp是64位 （register）")]),s._v(" "),t("p",[s._v("rsp是完整的64位;\nesp是rsp的低32位;\nsp 是rsp的低16位;")]),s._v(" "),t("p",[s._v("pc 程序计数器")]),s._v(" "),t("h2",{attrs:{id:"寄存器用途"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#寄存器用途"}},[s._v("#")]),s._v(" 寄存器用途")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("%rax 作为函数返回值使用")])]),s._v(" "),t("li",[t("p",[s._v("%rsp 栈指针寄存器，指向栈顶")])]),s._v(" "),t("li",[t("p",[s._v("%rdi  %rsi  %rdx  %rcx  %r8  %r9 用作函数参数，依次对应第1-6个参数. 最多有六个整形或指针型参数通过寄存器传递，超过六个只能通过栈来传递")])])]),s._v(" "),t("p",[s._v("一般寄存器:AX、BX、CX、DX\nAX:累积暂存器，BX:基底暂存器，CX:计数暂存器，DX:资料暂存器")]),s._v(" "),t("p",[s._v("索引暂存器:SI、DI\nSI:来源索引暂存器，DI:目的索引暂存器")]),s._v(" "),t("p",[s._v("堆叠、基底暂存器:SP、BP\nSP:堆叠指标暂存器，BP:基底指标暂存器")]),s._v(" "),t("p",[s._v("EAX、ECX、EDX、EBX：为ax,bx,cx,dx的延伸，各为32位元\nESI、EDI、ESP、EBP：为si,di,sp,bp的延伸，32位元")]),s._v(" "),t("p",[s._v("eax, ebx, ecx, edx, esi, edi, ebp, esp等都是X86 汇编语言中CPU上的通用寄存器的名称，是32位的寄存器。如果用C语言来解释，可以把这些寄存器当作变量看待。")]),s._v(" "),t("p",[s._v("比方说：add eax,-2 ; //可以认为是给变量eax加上-2这样的一个值。")]),s._v(" "),t("p",[s._v("这些32位寄存器有多种用途，但每一个都有“专长”，有各自的特别之处。")]),s._v(" "),t("ul",[t("li",[s._v('EAX 是"累加器"(accumulator), 它是很多加法乘法指令的缺省寄存器。')]),s._v(" "),t("li",[s._v('EBX 是"基地址"(base)寄存器, 在内存寻址时存放基地址。')]),s._v(" "),t("li",[s._v("ECX 是计数器(counter), 是重复(REP)前缀指令和LOOP指令的内定计数器。")]),s._v(" "),t("li",[s._v("EDX 则总是被用来放整数除法产生的余数。")])]),s._v(" "),t("h2",{attrs:{id:"汇编语法和编译器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#汇编语法和编译器"}},[s._v("#")]),s._v(" 汇编语法和编译器")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://t.zoukankan.com/zpcdbky-p-14837963.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://t.zoukankan.com/zpcdbky-p-14837963.html"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"at-t语法-和-intel语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#at-t语法-和-intel语法"}},[s._v("#")]),s._v(" AT&T语法 和 Intel语法")]),s._v(" "),t("p",[s._v("这是两种不同的语法，AT&T主要用于UNIX，Intel语法主要用于Windows")]),s._v(" "),t("h3",{attrs:{id:"gas编译器-和-nasm编译器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gas编译器-和-nasm编译器"}},[s._v("#")]),s._v(" GAS编译器 和 NASM编译器")]),s._v(" "),t("p",[s._v("这是两种不同的编译器，\nGAS是GNU Assembler的简写，基于AT&T syntax指令，生成.s文件\nNASM是Netwide Assembler的简写，基于Intel syntax指令，生成.asm文件")]),s._v(" "),t("h3",{attrs:{id:"源操作数和目的操作数的前后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#源操作数和目的操作数的前后"}},[s._v("#")]),s._v(" 源操作数和目的操作数的前后")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/wanglx_/article/details/7474070",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/wanglx_/article/details/7474070"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("x86汇编一直存在两种不同的语法，intel语法和AT&T语法，在intel的官方文档中使用intel语法，Windows也使用intel语法，而UNIX平台的汇编器一直使用AT&T语法。")]),s._v(" "),t("p",[s._v("unix下使用gas编译器的AT&T语法主要有以下特点：")]),s._v(" "),t("ul",[t("li",[s._v("寄存器名前缀%")]),s._v(" "),t("li",[s._v("操作数是源在前，目的在后，如 "),t("code",[s._v("mov %src %tar")]),s._v("， 与Intel语法刚好相反。")]),s._v(" "),t("li",[s._v("操作数长度在指令名后缀，b表示8位，w表示16位，l表示32位，如"),t("code",[s._v("movl %ebx,%eax")]),s._v("。")]),s._v(" "),t("li",[s._v("立即操作数（常量）用$标示，如addl $5,%eax")]),s._v(" "),t("li",[s._v("变量加不加$有区别。如movl $foo, %eax表示把foo变量地址放入寄存器%eax。movl foo,%eax表示把foo变量值放入寄存器%eax。")])]),s._v(" "),t("p",[s._v("操作数前后的记忆方法小技巧：对于mov指令，假设src在前des在后是比较方便符合直觉的，寄存器加%是不方便的，那么这两种语法总是都有方便和不方便的地方。下面假设src和tar是寄存器，则：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mov %src %tar  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unix下使用GAS编译器的AT&T语法，src和tar前后方便，但是加%不方便 ")]),s._v("\n`mov "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" src   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# windows下使用NASM编译器的INtel语法， src和tar前后不方便，但是不加%方便")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"gdb用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gdb用法"}},[s._v("#")]),s._v(" gdb用法")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("title: gdb用法-ida逆向-friad_hook\ndate: 2021-10-06 01:44:49\npermalink: /pages/1b0902/\ncategories:")]),s._v(" "),t("ul",[t("li",[s._v("Linux\ntags:")]),s._v(" "),t("li")]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"设置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置参数"}},[s._v("#")]),s._v(" 设置参数")]),s._v(" "),t("p",[s._v("进入gdb后: "),t("code",[s._v("set args 参数1 参数2")])]),s._v(" "),t("p",[s._v("或者启动gdb时 "),t("code",[s._v("gdb --args a.out arg1 arg2")])]),s._v(" "),t("h3",{attrs:{id:"回车重复执行上一次命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回车重复执行上一次命令"}},[s._v("#")]),s._v(" 回车重复执行上一次命令")]),s._v(" "),t("h3",{attrs:{id:"layout显示代码-tui模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#layout显示代码-tui模式"}},[s._v("#")]),s._v(" layout显示代码，tui模式")]),s._v(" "),t("p",[s._v("参考: "),t("a",{attrs:{href:"https://blog.csdn.net/zhangjs0322/article/details/10152279",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/zhangjs0322/article/details/10152279"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("进入gdb后, 执行"),t("code",[s._v("layout src")]),s._v("\nlayout: 用于分割窗口，可以一边查看代码，一边测试。主要有以下几种用法:")]),s._v(" "),t("ul",[t("li",[s._v("layout src: 显示源代码窗口")]),s._v(" "),t("li",[s._v("layout asm: 显示汇编窗口")]),s._v(" "),t("li",[s._v("layout regs: 显示源代码/汇编和寄存器窗口")]),s._v(" "),t("li",[s._v("layout split: 显示源代码和汇编窗口")]),s._v(" "),t("li",[s._v("layout next: 显示下一个layout")]),s._v(" "),t("li",[s._v("layout prev: 显示上一个layout")])]),s._v(" "),t("p",[s._v("layout窗口控制和退出:")]),s._v(" "),t("ul",[t("li",[s._v("Ctrl + x，再按1: 单窗口模式，显示一个窗口")]),s._v(" "),t("li",[s._v("Ctrl + x，再按2: 双窗口模式，显示两个窗口")]),s._v(" "),t("li",[s._v("Ctrl + x，再按a: 回到传统模式，即退出layout，回到执行layout之前的调试窗口。")]),s._v(" "),t("li",[s._v("如果Ctrl+x不生效，则先执行"),t("code",[s._v("set keymap vi")]),s._v("  或者 "),t("code",[s._v("set editing-mode vi")]),s._v(" ，就可以生效了。")]),s._v(" "),t("li",[s._v("layout 模式显示多个窗口时，如果焦点不在cmd窗口，则上下按键不起作用， 输入"),t("code",[s._v("fs next")]),s._v("可切换窗口焦点至cmd")])]),s._v(" "),t("p",[s._v("有时候layout asm显示的代码窗口太小看不全，可以在非layout模式下用"),t("code",[s._v("disassemble")]),s._v("直接显示反汇编代码，")]),s._v(" "),t("h3",{attrs:{id:"指定源文件搜索路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定源文件搜索路径"}},[s._v("#")]),s._v(" 指定源文件搜索路径")]),s._v(" "),t("p",[t("code",[s._v("(gdb) dir <xxx>")])]),s._v(" "),t("p",[s._v("gdb停到断点的时候，会显示当前断点的源文件路径")]),s._v(" "),t("h3",{attrs:{id:"查看内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看内存"}},[s._v("#")]),s._v(" 查看内存")]),s._v(" "),t("p",[s._v("(gdb) x /nfu addr")]),s._v(" "),t("ul",[t("li",[s._v("n，n个单元，数字")]),s._v(" "),t("li",[s._v("f，显示格式为f，x十六进制，d十进制，c字符，f浮点数")]),s._v(" "),t("li",[s._v("u，单元u的形式，bhwg, 单双四八字节")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("(gdb) x/20xw  0x7fffffffe230   显示20个单元，16进制显示，4字节每单元\n(gdb) x/20xb  0x7fffffffe230   显示20个单元，16进制显示，1字节每单元\n(gdb) x/s     0x7fffffffe230      显示指针处的字符串\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"查看寄存器的值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看寄存器的值"}},[s._v("#")]),s._v(" 查看寄存器的值")]),s._v(" "),t("p",[s._v("函数入参:")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" x/s "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rdi")]),s._v("    查看rdi寄存器处字符串的值， （函数入口 rdi表示第一个参数，6个参数分别为 rdi rsi rdx rcx r8 r9）\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" x/64xb "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rdi")]),s._v("+0x36    将rdi寄存器处的值作为地址，打印其+36处地址的内存\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" p *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("int32_t *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rdi")]),s._v("+0x60"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    将rdi寄存器处的值作为地址，将其+60处地址转为int32_t类型打印出来\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pc")]),s._v("  查看程序计数器的值（当前程序代码运行的地址）\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sp")]),s._v("  查看栈指针就寄存器的值\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"设置变量的值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置变量的值"}},[s._v("#")]),s._v(" 设置变量的值")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置临时变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"在so的某个偏移量处打断点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在so的某个偏移量处打断点"}},[s._v("#")]),s._v(" 在so的某个偏移量处打断点")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看mapping信息，找到so的加载地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" i proc mapping\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建临时变量so_base")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$so_base")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7ffff71d8000\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在so指定偏移量处打断点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" b *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$so_base")]),s._v(" +0x7B05A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"监视值的变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监视值的变化"}},[s._v("#")]),s._v(" 监视值的变化")]),s._v(" "),t("p",[s._v("四、监视值变化")]),s._v(" "),t("p",[s._v("1、使用watch variable设置监视点，当value变化时，gdb会中断。")]),s._v(" "),t("p",[s._v("2、当离开variable的定义范围时，可能会使监视点不起作用。 可以使用地址监视:")]),s._v(" "),t("p",[s._v("print &variable找出地址address，然后"),t("code",[s._v("watch *(int*)address。")])]),s._v(" "),t("h3",{attrs:{id:"dprint-动态打印"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dprint-动态打印"}},[s._v("#")]),s._v(" dprint 动态打印")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在指定行打印")]),s._v("\ndprint sometest.cpp:13,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"in dprint a=%d, i=%d'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(",a,i\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在指定函数打印")]),s._v("\ndprintf  perf_msgr_client.cc:ready,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"In fun ready：c= %d，jobs=%d'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(",c，jobs\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("这种动态打印是特殊的断点，可以通过"),t("code",[s._v("i b")]),s._v("或者"),t("code",[s._v("info break")]),s._v("查看")]),s._v(" "),t("p",[s._v("dprintf的本质是断点，因此目标程序并不是持续执行的，目标程序因为断点而暂停执行，等dprintf打印消息后再继续")]),s._v(" "),t("p",[s._v("dprintf输出到文件: "),t("a",{attrs:{href:"https://sourceware.org/gdb/current/onlinedocs/gdb/Dynamic-Printf.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://sourceware.org/gdb/current/onlinedocs/gdb/Dynamic-Printf.html"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行"}},[s._v("#")]),s._v(" 执行")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" run: 重新开始运行文件（run-text: 加载文本文件，run-bin: 加载二进制文件）,简写r\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" start: 单步执行，运行程序，停在第一执行语句\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" next: 单步调试（逐过程，函数直接执行）,简写n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" step: 单步调试（逐语句: 跳入自定义函数内部执行）,简写s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" finish: 结束当前函数，返回到函数调用点，相当于跳出\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" continue: 继续运行,简写c\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("正在运行时，按Ctrl+C暂停")]),s._v(" "),t("h3",{attrs:{id:"切换线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#切换线程"}},[s._v("#")]),s._v(" 切换线程")]),s._v(" "),t("p",[s._v("(gdb) info threads   查看线程信息\n(gdb) thread n    切换线程")]),s._v(" "),t("h3",{attrs:{id:"断点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#断点"}},[s._v("#")]),s._v(" 断点")]),s._v(" "),t("p",[s._v("设置断点  break   简写b\n设置临时断点: tbreak  简写tb")]),s._v(" "),t("p",[s._v("(gdb) b *(0x7ffff71d806) 在函数地址处打断点\n(gdb) b send     在send函数地址处打断点\n(gdb) b _ZN7dce_api10common_imp12on_sync_dataEiPv     在_ZN7dcxxx函数地址处打断点\n(gdb) b xx.cpp:26  在xx.cpp第26行设置断点")]),s._v(" "),t("p",[s._v("(gdb) info breakpoints: 查看当前设置的所有断点\n(gdb) delete breakpoints num: 删除第num个断点,简写d")]),s._v(" "),t("h3",{attrs:{id:"其他命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他命令"}},[s._v("#")]),s._v(" 其他命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("(gdb) info proc mapping  查看内存映射\n(gdb) info reg  查看寄存器的值，简写为 i r\n(gdb) help: 查看命令帮助，具体命令查询在gdb中输入help + 命令,简写h\n(gdb) list: 查看原代码（list-n,从第n行开始查看代码。list+ 函数名: 查看具体函数）,简写l\n(gdb) backtrace: 查看函数的调用的栈帧和层级关系,简写bt\n(gdb) frame: 切换函数的栈帧,简写f\n(gdb) info: 查看函数内部局部变量的数值,简写i\n\n\n(gdb) print: 打印值及地址,简写p\n(gdb) quit: 退出gdb,简写q\n(gdb) display: 追踪查看具体变量值\n(gdb) undisplay: 取消追踪观察变量\n(gdb) watch: 被设置观察点的变量发生修改时，打印显示\n(gdb) i watch: 显示观察点\n(gdb) enable breakpoints: 启用断点\n(gdb) disable breakpoints: 禁用断点\n(gdb) run argv[1] argv[2]: 调试时命令行传参\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"增加源代码的查找路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加源代码的查找路径"}},[s._v("#")]),s._v(" 增加源代码的查找路径")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果debug信息中的文件路径是相对路径，则用dir增加对应的folder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" path_to_src_folder\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果debug信息中的文件路径是绝对路径，则重定向")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" substitute-path old_path new_path\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"hook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hook"}},[s._v("#")]),s._v(" hook")]),s._v(" "),t("ul",[t("li",[s._v("动态库hook: 一种简单的hook方式是preload")]),s._v(" "),t("li",[s._v("静态库hook: 编译时指定_warp_")]),s._v(" "),t("li",[s._v("任意地址hook: inline hook，可去GitHub上找相关的实现。其实就是修改call指令的目的地址，跳到自己定义的函数处执行。")]),s._v(" "),t("li",[s._v("也有一些专业的hook库，如friad等。")])]),s._v(" "),t("h3",{attrs:{id:"ida中逆向常用的宏定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ida中逆向常用的宏定义"}},[s._v("#")]),s._v(" ida中逆向常用的宏定义")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/huiguixian/article/details/52026710",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/huiguixian/article/details/52026710"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("在ida安装目录，找到defs.h，包含即可。一般在plugins目录下")]),s._v(" "),t("h2",{attrs:{id:"典型函数调用过程中栈指针寄存器的变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#典型函数调用过程中栈指针寄存器的变化"}},[s._v("#")]),s._v(" 典型函数调用过程中栈指针寄存器的变化")]),s._v(" "),t("h3",{attrs:{id:"system-v-amd64-函数调用约定-callee-saved寄存器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#system-v-amd64-函数调用约定-callee-saved寄存器"}},[s._v("#")]),s._v(" System V AMD64 函数调用约定：callee-saved寄存器")]),s._v(" "),t("ul",[t("li",[s._v("System V AMD64 是基于x86_64架构Linux系统上广泛使用的一种调用约定, 我们在Linux系统上用gcc编译的代码默认都是遵循这种调用约定。其他还有：\n"),t("ul",[t("li",[s._v("cdecl (C declaration)：是32位平台常见的一种约定，GCC、Clang、Visual Studio的C编译器都默认使用这种调用约定。")]),s._v(" "),t("li",[s._v("Microsoft x64：微软提出的基于x86_64架构的Windows系统上的一种调用约定")]),s._v(" "),t("li",[s._v("stdcall：它是用于32位Windows上的一种调用约定。")])])])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_29328443/article/details/107232025",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/qq_29328443/article/details/107232025"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("caller-saved register, 调用者保存寄存器，也叫易失寄存器。因为被调用函数可以随便用这些寄存器，用完了也不需要恢复，caller需要自己负责保存。")]),s._v(" "),t("p",[s._v("callee-saved register，被调用者保存寄存器，也叫非易失寄存器，包括%rbx, %rsp, %rbp, %r12-r14, %r15, x87 CW，其中%rsp和%rbp是重点；")]),s._v(" "),t("h3",{attrs:{id:"demo查看反汇编"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo查看反汇编"}},[s._v("#")]),s._v(" demo查看反汇编")]),s._v(" "),t("p",[s._v("将下面的程序编译，查看反汇编")]),s._v(" "),t("p",[s._v("test_call.c:")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<iostream>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<unistd.h>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a=%d\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("编译： "),t("code",[s._v("g++ -o a.out -g -O0 test_call.c")])]),s._v(" "),t("p",[s._v("查看反汇编："),t("code",[s._v("objdump -d a.out")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# main 部分")]),s._v("\n00000000004006c7 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("main"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":\n  4006c7:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("                      push   %rbp\n  4006c8:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" e5                mov    %rsp,%rbp\n  4006cb:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v(" ec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("             sub    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x20")]),s._v(",%rsp\n  4006cf:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" b8 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" 6c 6c 6f    movabs "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x6f6c6c6568")]),s._v(",%rax\n  4006d6:       00 00 00\n  4006d9:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" e0             mov    %rax,-0x20"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  4006dd:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" c7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" e8 00 00 00    movq   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x0")]),s._v(",-0x18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  4006e4:       00\n  4006e5:       e8 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v(" ff ff ff          callq  40067d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("_Z3foov"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用foo")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# callq指令，q表示8字节。 e8就是call指令")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# call指令会push当前ip寄存器的下一条指令地址，然后跳转到目标函数地址。")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于64位程序，push rip后，sp指针会自动-8")]),s._v("\n  4006ea:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" fc                mov    %eax,-0x4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  4006ed:       8b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" fc                mov    -0x4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",%eax\n  4006f0:       c9                      leaveq\n  4006f1:       c3                      retq\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# foo部分")]),s._v("\n000000000040067d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("_Z3foov"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":\n  40067d:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("                      push   %rbp    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入函数后，首先push rbp寄存器入栈，保存父函数的rbp到栈里")]),s._v("\n  40067e:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" e5                mov    %rsp,%rbp  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后将父函数的rsp作为当前的rbp")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400681")]),s._v(":       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v(" ec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("             sub    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x20")]),s._v(",%rsp  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#栈指针下移，分配栈空间。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400685")]),s._v(":       c7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" fc 05 00 00 00    movl   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x5")]),s._v(",-0x4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  40068c:       c7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" f8 08 00 00 00    movl   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x8")]),s._v(",-0x8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400693")]),s._v(":       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" b8 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" 6c 6c 6f    movabs "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0xa6f6c6c6568")]),s._v(",%rax\n  40069a:       0a 00 00\n  40069d:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" e0             mov    %rax,-0x20"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  4006a1:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" c7 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" e8 00 00 00    movq   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x0")]),s._v(",-0x18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  4006a8:       00\n  4006a9:       8b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" fc                mov    -0x4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",%eax\n  4006ac:       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" c6                   mov    %eax,%esi\n  4006ae:       bf e0 07 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 00          mov    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x4007e0")]),s._v(",%edi\n  4006b3:       b8 00 00 00 00          mov    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x0")]),s._v(",%eax\n  4006b8:       e8 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" fe ff ff          callq  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400530")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("printf@plt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  4006bd:       8b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" f8                mov    -0x8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",%eax\n  4006c0:       8b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v(" fc                mov    -0x4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("%rbp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",%edx\n  4006c3:       01 d0                   "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("    %edx,%eax\n  4006c5:       c9                      leaveq  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# leaveq相当于两条指令：  ")]),s._v("\n                                                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `movq %rbp, %rsp`(恢复父函数的rsp)")]),s._v("\n                                                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `popq %rbp`(恢复父函数的rbp)")]),s._v("\n  4006c6:       c3                      retq    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# retq相当于：popq %rip （将rip恢复为父函数中call指令的下一条指令地址）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br")])]),t("p",[s._v("[ATT汇编]后缀字母：")]),s._v(" "),t("ul",[t("li",[s._v("b字节=1字节")]),s._v(" "),t("li",[s._v("w字=2字节")]),s._v(" "),t("li",[s._v("l双字=4字节")]),s._v(" "),t("li",[s._v("q, Quad Word, 四字=8字节")])]),s._v(" "),t("p",[s._v("可尝试gdb运行并查看寄存器的变化")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ gdb a.out\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" start       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入main函数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" layout "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示源码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" layout reg  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示寄存器窗口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" si          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单步执行")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". push   %rbp    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用call进入函数后，首先push rbp寄存器入栈，保存父函数的rbp到栈里")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". mov    %rsp,%rbp  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后将父函数的rsp作为当前的rbp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". sub    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0x20")]),s._v(",%rsp  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#栈指针下移，分配栈空间。不一定有")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行函数内容")]),s._v("\n\n* leaveq  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# leaveq相当于两条指令：  ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `movq %rbp, %rsp`(恢复父函数的rsp)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `popq %rbp`(恢复父函数的rbp)")]),s._v("\n* retq    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# retq相当于：popq %rip （将rip恢复为父函数中call指令的下一条指令地址）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);